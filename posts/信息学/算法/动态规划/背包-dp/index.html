<!DOCTYPE html>
<html lang="en"><head><title>背包问题 - Yharim Area</title><meta charset="utf-8">
    <meta name="author" content="Yharim">
    <meta name="Robots" content="All">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="renderer" content="webkit">
    <meta name="force-rendering" content="webkit">
    <meta http-equiv="windows-Target" content="_top">

    <link rel="shortcut icon" type="image/x-icon" href="../../../../../logo.svg" />
    <link rel="alt" type="application/rss+xml" href=../../../../../index.xml title="Yharim Area" />
    <link rel="stylesheet" href=../../../../../_index.css>
</head><body><div class="LBody" id="start">
        <aside class="LSide"><header class="header">
    <div class="logo-wrap">
        <a class="avatar" href="../../../../../">
            <div class="mask"></div>
            <div class="bg" style="background-image:url(/img/rainbow64@3x.webp)"></div>
            <img class="avatar" src="../../../../../avatar.png" onerror="this.classList.add('error');this.src='../../../../../img/unknow.svg';">
        </a>
        <a class="title" href="../../../../../">
            <div class="main" ff="title">Yharim</div>
            <div class="sub normal cap">Snow is on the ground</div>
            <div class="sub hover cap">Welcome to Yharim Area</div>
        </a>
    </div>
    <nav class="menu dis-select"><a class="nav-item active" href="../../../../../">博客</a><a class="nav-item " href="../../../../../docs/">文档</a><a class="nav-item " href="../../../../../search/">搜索</a><a class="nav-item " href="../../../../../about/">关于</a></nav>
</header><div class="widgets"><div class="widget search"><widget class="widget-wrapper search">
    <div class="widget-body">
        <div class="search-wrapper" id="search">
            <div class="search-form">
                <input type="text" class="search-input" id="search-input" placeholder="Search" AUTOCOMPLETE="off">
                <svg t="1670596976048" class="icon search-icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2676" width="200" height="200"><path d="M938.2 832.6L723.8 618.1c-2.5-2.5-5.3-4.4-7.9-6.4 36.2-55.6 57.3-121.8 57.3-193.1C773.3 222.8 614.6 64 418.7 64S64 222.8 64 418.6c0 195.9 158.8 354.6 354.6 354.6 71.3 0 137.5-21.2 193.2-57.4 2 2.7 3.9 5.4 6.3 7.8L832.5 938c14.6 14.6 33.7 21.9 52.8 21.9 19.1 0 38.2-7.3 52.8-21.8 29.2-29.1 29.2-76.4 0.1-105.5M418.7 661.3C284.9 661.3 176 552.4 176 418.6 176 284.9 284.9 176 418.7 176c133.8 0 242.6 108.9 242.6 242.7 0 133.7-108.9 242.6-242.6 242.6" p-id="2677"></path></svg>
            </div>
        </div>
    </div>
</widget></div><div class="widget toc"><widgets class="widget-wrapper toc">
    <div class="widget-header cap dis-select">
        <a class="name" href="#">背包问题</a>
    </div>
    <div class="widget-body fs14">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#01-背包">01 背包</a>
      <ul>
        <li><a href="#空间优化">空间优化</a></li>
      </ul>
    </li>
    <li><a href="#完全背包">完全背包</a>
      <ul>
        <li><a href="#空间优化-1">空间优化</a></li>
      </ul>
    </li>
    <li><a href="#多重背包">多重背包</a>
      <ul>
        <li><a href="#二进制优化">二进制优化</a></li>
      </ul>
    </li>
    <li><a href="#分组背包">分组背包</a></li>
    <li><a href="#二维背包">二维背包</a></li>
    <li><a href="#方案总数">方案总数</a></li>
    <li><a href="#最优方案总数">最优方案总数</a></li>
  </ul>
</nav>
    </div>
</widgets></div></div>
<footer class="footer dis-select">
    <div class="social-wrap"><a class="social" href="https://gohugo.io/" target="_blank">
            <img src="../../../../../social/hugo.png">
        </a><a class="social" href="https://github.com/Yharimium/" target="_blank">
            <img src="../../../../../social/github.svg">
        </a><a class="social" href="https://space.bilibili.com/1116690502/" target="_blank">
            <img src="../../../../../social/bilibili.ico">
        </a></div>
</footer></aside>
        <main class="LMain"><header class="header mobile-only">
  <div class="logo-wrap">
      <a class="avatar" href="../../../../../">
          <div class="mask"></div>
          <div class="bg" style="background-image:url(/img/rainbow64@3x.webp)"></div>
          <img class="avatar" src="../../../../../avatar.png" onerror="this.classList.add('error');this.src='../../../../../img/unknow.svg';">
      </a>
      <a class="title" href="../../../../../">
          <div class="main" ff="title">Yharim</div>
          <div class="sub normal cap">Snow is on the ground</div>
          <div class="sub hover cap">Welcome to Yharim Area</div>
      </a>
  </div>
</header><div class="bread-nav fs12"><div class="breadcrumb"><a class="cap item" href="../../../../../categories/%e4%bf%a1%e6%81%af%e5%ad%a6">信息学</a>
      <span class="sep">/</span><a class="cap item" href="../../../../../categories/%e7%ae%97%e6%b3%95">算法</a>
      <span class="sep">/</span></div><div class="breadcrumb"><a class="cap item" href="../../../../../tags/dp">DP</a>
      <span class="sep">/</span></div><div class="post-meta">发布于 2021-1-19</div>
</div>

<article class="md-text content post">
  <h1 class="article-title">背包问题</h1>
  <span class="description"></span><h2 id="#01-背包">
    01 背包
    <a class="anchor" name="01-背包" href="#01-%e8%83%8c%e5%8c%85">#</a>
</h2><blockquote>
<p>给定 $n$ 个物品，第 $i$ 个物品体积为 $c[i]$, 价值为 $w[i]$. 现有容积为 $m$ 的背包，求将物品装入背包得到的最大价值.</p>
</blockquote>
<p>$f[i,v]$: 从前 $i$ 个物品中，选出总体积为 $v$ 的物品，能得到的最大价值.</p>
<ul>
<li>不选第 $i$ 个物品：$f[i,v]=f[i-1,v]$.</li>
<li>选第 $i$ 个物品：$f[i,v]=f[i-1,v-w_i]+c_i$.</li>
</ul>
<p>$$f[i,v] = \max\left\{\begin{aligned}
&amp;f[i-1,v]\\
&amp;f[i-1,v-w_i]&#43;c_i\quad(v≥w_i)\\
\end{aligned}\right.$$</p><p>时间复杂度：$O(nm)$.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">v</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="p">;</span> <span class="n">v</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">v</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">&gt;=</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">v</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">v</span> <span class="o">-</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 问题的解是 f[n][m]
</span></span></span></code></pre></div><h3 id="#空间优化">
    空间优化
    <a class="anchor" name="空间优化" href="#%e7%a9%ba%e9%97%b4%e4%bc%98%e5%8c%96">#</a>
</h3><p>实际上，<a class="md-link" href="../../../../../post/dynamic-programming/dynamic-programming/#state-transition-equation"  >状态转移方程<img class="icon" src="../../../../../img/link.svg" /></a> 的第一维可以去掉，即让新状态覆盖旧状态，以降低空间开销.</p>
<p>$$f[v] = \max\left\{\begin{aligned}
&amp;f[v]\\
&amp;f[v-w_i]&#43;c_i\quad(v≥w_i)
\end{aligned}\right.$$</p><p>但在程序中，直接移除第一维会导致错误. 令 $w=1,c=2$，执行内层循环，可见错误的根源.</p>
<div class="book-tabs"><input type="radio" class="toggle" name="tabs-%!s(int=1)" id="tabs-%!s(int=1)-0"
        checked="checked" />
    <label class="label " for="tabs-%!s(int=1)-0">$v=1$</label>
    
    <div class="inner"><table>
<thead>
<tr>
<th style="text-align:center">$v$</th>
<th style="text-align:center">$0$</th>
<th style="text-align:center">$1$</th>
<th style="text-align:center">$2$</th>
<th style="text-align:center">$3$</th>
<th style="text-align:center">$4$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$f[v]$</td>
<td style="text-align:center">$\textcolor{blue}{0}$</td>
<td style="text-align:center">$\textcolor{blue}{f[v-w]}+c=2$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$0$</td>
</tr>
</tbody>
</table>
</div>
    <input type="radio" class="toggle" name="tabs-%!s(int=1)" id="tabs-%!s(int=1)-1"
         />
    <label class="label " for="tabs-%!s(int=1)-1">$v=2$</label>
    
    <div class="inner"><table>
<thead>
<tr>
<th style="text-align:center">$v$</th>
<th style="text-align:center">$0$</th>
<th style="text-align:center">$1$</th>
<th style="text-align:center">$2$</th>
<th style="text-align:center">$3$</th>
<th style="text-align:center">$4$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$f[v]$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$\textcolor{blue}{2}$</td>
<td style="text-align:center">$\textcolor{blue}{f[v-w]}+c=4$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$0$</td>
</tr>
</tbody>
</table>
</div>
    <input type="radio" class="toggle" name="tabs-%!s(int=1)" id="tabs-%!s(int=1)-2"
         />
    <label class="label " for="tabs-%!s(int=1)-2">$v=3$</label>
    
    <div class="inner"><table>
<thead>
<tr>
<th style="text-align:center">$v$</th>
<th style="text-align:center">$0$</th>
<th style="text-align:center">$1$</th>
<th style="text-align:center">$2$</th>
<th style="text-align:center">$3$</th>
<th style="text-align:center">$4$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$f[v]$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$\textcolor{blue}{4}$</td>
<td style="text-align:center">$\textcolor{blue}{f[v-w]}+c=6$</td>
<td style="text-align:center">$0$</td>
</tr>
</tbody>
</table>
</div>
    <input type="radio" class="toggle" name="tabs-%!s(int=1)" id="tabs-%!s(int=1)-3"
         />
    <label class="label " for="tabs-%!s(int=1)-3">$v=4$</label>
    
    <div class="inner"><table>
<thead>
<tr>
<th style="text-align:center">$v$</th>
<th style="text-align:center">$0$</th>
<th style="text-align:center">$1$</th>
<th style="text-align:center">$2$</th>
<th style="text-align:center">$3$</th>
<th style="text-align:center">$4$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$f[v]$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$4$</td>
<td style="text-align:center">$\textcolor{blue}{6}$</td>
<td style="text-align:center">$\textcolor{blue}{f[v-w]}+c=8$</td>
</tr>
</tbody>
</table>
</div>
    </div>

<p>在内层循环中，$f[v-w]$ 不能比 $f[v]$ 先更新，否则相当于同一物品被装多次. 倒序枚举 $v$ 以解决问题.</p>
<div class="book-tabs"><input type="radio" class="toggle" name="tabs-%!s(int=2)" id="tabs-%!s(int=2)-0"
        checked="checked" />
    <label class="label " for="tabs-%!s(int=2)-0">$v=4$</label>
    
    <div class="inner"><table>
<thead>
<tr>
<th style="text-align:center">$v$</th>
<th style="text-align:center">$0$</th>
<th style="text-align:center">$1$</th>
<th style="text-align:center">$2$</th>
<th style="text-align:center">$3$</th>
<th style="text-align:center">$4$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$f[v]$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$\textcolor{blue}{0}$</td>
<td style="text-align:center">$\textcolor{blue}{f[v-w]}+c=2$</td>
</tr>
</tbody>
</table>
</div>
    <input type="radio" class="toggle" name="tabs-%!s(int=2)" id="tabs-%!s(int=2)-1"
         />
    <label class="label " for="tabs-%!s(int=2)-1">$v=3$</label>
    
    <div class="inner"><table>
<thead>
<tr>
<th style="text-align:center">$v$</th>
<th style="text-align:center">$0$</th>
<th style="text-align:center">$1$</th>
<th style="text-align:center">$2$</th>
<th style="text-align:center">$3$</th>
<th style="text-align:center">$4$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$f[v]$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$\textcolor{blue}{0}$</td>
<td style="text-align:center">$\textcolor{blue}{f[v-w]}+c=2$</td>
<td style="text-align:center">$2$</td>
</tr>
</tbody>
</table>
</div>
    <input type="radio" class="toggle" name="tabs-%!s(int=2)" id="tabs-%!s(int=2)-2"
         />
    <label class="label " for="tabs-%!s(int=2)-2">$v=2$</label>
    
    <div class="inner"><table>
<thead>
<tr>
<th style="text-align:center">$v$</th>
<th style="text-align:center">$0$</th>
<th style="text-align:center">$1$</th>
<th style="text-align:center">$2$</th>
<th style="text-align:center">$3$</th>
<th style="text-align:center">$4$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$f[v]$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$\textcolor{blue}{0}$</td>
<td style="text-align:center">$\textcolor{blue}{f[v-w]}+c=2$</td>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$2$</td>
</tr>
</tbody>
</table>
</div>
    <input type="radio" class="toggle" name="tabs-%!s(int=2)" id="tabs-%!s(int=2)-3"
         />
    <label class="label " for="tabs-%!s(int=2)-3">$v=1$</label>
    
    <div class="inner"><table>
<thead>
<tr>
<th style="text-align:center">$v$</th>
<th style="text-align:center">$0$</th>
<th style="text-align:center">$1$</th>
<th style="text-align:center">$2$</th>
<th style="text-align:center">$3$</th>
<th style="text-align:center">$4$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$f[v]$</td>
<td style="text-align:center">$\textcolor{blue}{0}$</td>
<td style="text-align:center">$\textcolor{blue}{f[v-w]}+c=2$</td>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$2$</td>
</tr>
</tbody>
</table>
</div>
    </div>

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span> <span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">v</span> <span class="o">=</span> <span class="n">m</span><span class="p">;</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">v</span> <span class="o">--</span><span class="p">)</span>    <span class="c1">// 倒序枚举
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">f</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">v</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="n">v</span> <span class="o">-</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span></code></pre></div><h2 id="#完全背包">
    完全背包
    <a class="anchor" name="完全背包" href="#%e5%ae%8c%e5%85%a8%e8%83%8c%e5%8c%85">#</a>
</h2><blockquote>
<p>基于 <a class="md-link" href="#01-%e8%83%8c%e5%8c%85"  >01 背包<img class="icon" src="../../../../../img/link.svg" /></a>，每种物品可装无限次.</p>
</blockquote>
<p>$f[i,v]$: 从前 $i$ 种物品中，选出总体积为 $v$ 的物品，能得到的最大价值.</p>
<ul>
<li>不选第 $i$ 种物品：$f[i,v]=f[i-1,v]$.</li>
<li>多选一个第 $i$ 种物品：$f[i,v]=f[i,v-w_i]+c_i$.</li>
</ul>
<p>$$f[i,v] = \max\left\{\begin{aligned}
&amp;f[i-1,v]\\
&amp;f[i,v-w_i]&#43;c_i\quad(v≥w_i)
\end{aligned}\right.$$</p><p>时间复杂度：$O(nm)$.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span> <span class="n">v</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">v</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">&gt;=</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">v</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">v</span> <span class="o">-</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="#空间优化-1">
    空间优化
    <a class="anchor" name="空间优化-1" href="#%e7%a9%ba%e9%97%b4%e4%bc%98%e5%8c%96-1">#</a>
</h3><p>参照 <a class="md-link" href="#%e7%a9%ba%e9%97%b4%e4%bc%98%e5%8c%96"  >01 背包 - 空间优化<img class="icon" src="../../../../../img/link.svg" /></a> 中的错误做法：直接移除第一维，并升序枚举 $v$，相当于将同种物品装多次.</p>
<div class="book-tabs"><input type="radio" class="toggle" name="tabs-%!s(int=3)" id="tabs-%!s(int=3)-0"
        checked="checked" />
    <label class="label " for="tabs-%!s(int=3)-0">$v=1$</label>
    
    <div class="inner"><table>
<thead>
<tr>
<th style="text-align:center">$v$</th>
<th style="text-align:center">$0$</th>
<th style="text-align:center">$1$</th>
<th style="text-align:center">$2$</th>
<th style="text-align:center">$3$</th>
<th style="text-align:center">$4$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$f[v]$</td>
<td style="text-align:center">$\textcolor{blue}{0}$</td>
<td style="text-align:center">$\textcolor{blue}{f[v-w]}+c=2$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$0$</td>
</tr>
</tbody>
</table>
</div>
    <input type="radio" class="toggle" name="tabs-%!s(int=3)" id="tabs-%!s(int=3)-1"
         />
    <label class="label " for="tabs-%!s(int=3)-1">$v=2$</label>
    
    <div class="inner"><table>
<thead>
<tr>
<th style="text-align:center">$v$</th>
<th style="text-align:center">$0$</th>
<th style="text-align:center">$1$</th>
<th style="text-align:center">$2$</th>
<th style="text-align:center">$3$</th>
<th style="text-align:center">$4$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$f[v]$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$\textcolor{blue}{2}$</td>
<td style="text-align:center">$\textcolor{blue}{f[v-w]}+c=4$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$0$</td>
</tr>
</tbody>
</table>
</div>
    <input type="radio" class="toggle" name="tabs-%!s(int=3)" id="tabs-%!s(int=3)-2"
         />
    <label class="label " for="tabs-%!s(int=3)-2">$v=3$</label>
    
    <div class="inner"><table>
<thead>
<tr>
<th style="text-align:center">$v$</th>
<th style="text-align:center">$0$</th>
<th style="text-align:center">$1$</th>
<th style="text-align:center">$2$</th>
<th style="text-align:center">$3$</th>
<th style="text-align:center">$4$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$f[v]$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$\textcolor{blue}{4}$</td>
<td style="text-align:center">$\textcolor{blue}{f[v-w]}+c=6$</td>
<td style="text-align:center">$0$</td>
</tr>
</tbody>
</table>
</div>
    <input type="radio" class="toggle" name="tabs-%!s(int=3)" id="tabs-%!s(int=3)-3"
         />
    <label class="label " for="tabs-%!s(int=3)-3">$v=4$</label>
    
    <div class="inner"><table>
<thead>
<tr>
<th style="text-align:center">$v$</th>
<th style="text-align:center">$0$</th>
<th style="text-align:center">$1$</th>
<th style="text-align:center">$2$</th>
<th style="text-align:center">$3$</th>
<th style="text-align:center">$4$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$f[v]$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$4$</td>
<td style="text-align:center">$\textcolor{blue}{6}$</td>
<td style="text-align:center">$\textcolor{blue}{f[v-w]}+c=8$</td>
</tr>
</tbody>
</table>
</div>
    </div>

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span> <span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">v</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">v</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="p">;</span> <span class="n">v</span> <span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">f</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">v</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="n">v</span> <span class="o">-</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span></code></pre></div><h2 id="#多重背包">
    多重背包
    <a class="anchor" name="多重背包" href="#%e5%a4%9a%e9%87%8d%e8%83%8c%e5%8c%85">#</a>
</h2><blockquote>
<p>基于 <a class="md-link" href="#01-%e8%83%8c%e5%8c%85"  >01 背包<img class="icon" src="../../../../../img/link.svg" /></a>，第 $i$ 种物品可装 $s_i$ 次.</p>
</blockquote>
<p>在内层循环中，分别绑定 $1,2,\cdots s_i$ 个物品作为一个物品，参与 01 背包.</p>
<p>$$f[v] = \max_{k=1,2,\cdots,s_i}\begin{cases}
f[v]\\
f[v-k\cdot w_i]&#43;k\cdot c_i\quad(v≥k\cdot w_i)
\end{cases}$$</p><p>时间复杂度：$O(m\sum s_i)$.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span> <span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">v</span> <span class="o">=</span> <span class="n">m</span><span class="p">;</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">v</span> <span class="o">--</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="n">k</span> <span class="o">*</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">k</span> <span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">f</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">v</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="n">v</span> <span class="o">-</span> <span class="n">k</span> <span class="o">*</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span></code></pre></div><h3 id="#二进制优化">
    二进制优化
    <a class="anchor" name="二进制优化" href="#%e4%ba%8c%e8%bf%9b%e5%88%b6%e4%bc%98%e5%8c%96">#</a>
</h3><ul>
<li>任意正整数 $n$ 可拆分为 $1,2,4,\cdots,2^k,n-2^k$（$n-2^k≥0$ 且 $k$ 尽量大）.</li>
<li>相反，$1,2,4,\cdots,2^k,n-2^k$ 能且仅能组合出 $[1,n]$ 中的所有整数.</li>
</ul>
<p>将 $s_i$ 个物品拆分为 $1,2,4,\cdots,2^k,s_i-2^k$ 个物品（共 $\log s_i$ 组），并绑定每组为一个物品，参与 01 背包.
例如，$s_i=15$ 可以拆分为以下 $4$ 组：</p>
<table>
<thead>
<tr>
<th style="text-align:center">组别</th>
<th style="text-align:center">$1$</th>
<th style="text-align:center">$2$</th>
<th style="text-align:center">$3$</th>
<th style="text-align:center">$4$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">总体积</td>
<td style="text-align:center">$w_i$</td>
<td style="text-align:center">$2w_i$</td>
<td style="text-align:center">$4w_i$</td>
<td style="text-align:center">$8w_i$</td>
</tr>
<tr>
<td style="text-align:center">总价值</td>
<td style="text-align:center">$c_i$</td>
<td style="text-align:center">$2c_i$</td>
<td style="text-align:center">$4c_i$</td>
<td style="text-align:center">$8c_i$</td>
</tr>
</tbody>
</table>
<p>此 $4$ 组物品可组合出所有策略（选 $1\cdots 15$ 个物品）. 例如要选 $12$ 个物品，则同时选第 $3,4$ 组即可.</p>
<p>时间复杂度：$O(m\sum\log{s_i})$.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">wi</span><span class="p">,</span> <span class="n">ci</span><span class="p">,</span> <span class="n">s</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">wi</span> <span class="o">&gt;&gt;</span> <span class="n">ci</span> <span class="o">&gt;&gt;</span> <span class="n">s</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="n">s</span><span class="p">;</span> <span class="n">k</span> <span class="o">*=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">w</span><span class="p">[</span><span class="o">++</span> <span class="n">cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span> <span class="o">*</span> <span class="n">wi</span><span class="p">,</span> <span class="n">c</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span> <span class="o">*</span> <span class="n">ci</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">s</span> <span class="o">-=</span> <span class="n">k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">w</span><span class="p">[</span><span class="o">++</span> <span class="n">cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">wi</span><span class="p">,</span> <span class="n">c</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">ci</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">tot</span><span class="p">;</span> <span class="n">i</span> <span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">v</span> <span class="o">=</span> <span class="n">m</span><span class="p">;</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">v</span> <span class="o">--</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">f</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">v</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="n">v</span> <span class="o">-</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span></code></pre></div><h2 id="#分组背包">
    分组背包
    <a class="anchor" name="分组背包" href="#%e5%88%86%e7%bb%84%e8%83%8c%e5%8c%85">#</a>
</h2><blockquote>
<p>背包体积为 $m$，有 $t$ 组物品，第 $k$ 组有 $s_k$ 个，其中第 $i$ 个体积为 $w_{ki}$，价值为 $c_{ki}$. 每组只能取走一个物品. 求将物品装入背包得到的最大价值.</p>
</blockquote>
<p>$f[k,v]$：从前 $k$ 组物品中，选出总体积为 $v$ 的物品，能得到的最大价值.</p>
<ul>
<li>不选第 $k$ 组：$f[k,v]=f[k-1,v]$.</li>
<li>选第 $k$ 组：$ f[k,v]=\max_{1\leq i\leq s_k}\ f[k-1,v-w_{ki}]+c_{ki}$.</li>
</ul>
<p>$$f[k,v] = \max\left\{\begin{aligned}
&amp;f[k-1,v]\\
&amp;\max_{1\leq i\leq s_k}\ f[k-1,v-w_{ki}]&#43;c_{ki}\quad(v≥w_{ki})
\end{aligned}\right.$$</p><p>可以省去第一维. 时间复杂度：$O(nm)$.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="n">t</span><span class="p">;</span> <span class="n">k</span> <span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">v</span> <span class="o">=</span> <span class="n">m</span><span class="p">;</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">v</span> <span class="o">--</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">s</span><span class="p">[</span><span class="n">k</span><span class="p">];</span> <span class="n">i</span> <span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">&gt;=</span> <span class="n">w</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">				<span class="n">f</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">v</span><span class="p">],</span><span class="n">f</span><span class="p">[</span><span class="n">v</span> <span class="o">-</span> <span class="n">w</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">]]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">]);</span>
</span></span></code></pre></div><h2 id="#二维背包">
    二维背包
    <a class="anchor" name="二维背包" href="#%e4%ba%8c%e7%bb%b4%e8%83%8c%e5%8c%85">#</a>
</h2><blockquote>
<p>背包体积为 $V$，承重为 $M$. 有 $n$ 个物品，第 $i$ 个体积为 $v_i$，质量为 $m_i$，价值为 $c_i$. 求将物品装入背包得到的最大价值.</p>
</blockquote>
<p>$f[p,q]$：用体积为 $p$，承重为 $q$ 的背包放物品，能获得的最大总价值.</p>
<p>$$f[p,q] = \max\left\{\begin{aligned}
&amp;f[p,q]\\
&amp;f[p-v_i,q-m_i]&#43;c_i\quad(p≥v_i,q≥m_i)
\end{aligned}\right.$$</p><p>时间复杂度为 $O(nVM)$.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span> <span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">p</span> <span class="o">=</span> <span class="n">V</span><span class="p">;</span> <span class="n">p</span> <span class="o">&gt;=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">p</span> <span class="o">--</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">q</span> <span class="o">=</span> <span class="n">M</span><span class="p">;</span> <span class="n">q</span> <span class="o">&gt;=</span> <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">q</span> <span class="o">--</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">f</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">q</span><span class="p">]</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">q</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="n">p</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">q</span> <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span></code></pre></div><h2 id="#方案总数">
    方案总数
    <a class="anchor" name="方案总数" href="#%e6%96%b9%e6%a1%88%e6%80%bb%e6%95%b0">#</a>
</h2><blockquote>
<p>基于 <a class="md-link" href="#01-%e8%83%8c%e5%8c%85"  >01 背包<img class="icon" src="../../../../../img/link.svg" /></a>，求将物品放入背包的方案数.</p>
</blockquote>
<p>$g[i,v]$：把前 $i$ 个物品（部分或全部）放入体积为 $v$ 的背包的方案总数.</p>
<ul>
<li>不放第 $i$ 个物品：有 $g[i-1,v]$ 种</li>
<li>放第 $i$ 个物品：有 $g[i-1,v-w_i]$ 种</li>
</ul>
<p>$$g[i,v]=g[i-1,v]+g[i-1,v-w_i]$$</p>
<p>同样可以省去第一维：</p>
<p>$$g[v]=g[v]+g[v-w_i]\quad(v≥w_i)$$</p>
<p>初始条件：$g[0]=1$. 因为当背包体积为 $0$ 时只有一个方案：不放任何物品.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span> <span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">v</span> <span class="o">=</span> <span class="n">m</span><span class="p">;</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">v</span> <span class="o">--</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">g</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">+=</span> <span class="n">g</span><span class="p">[</span><span class="n">v</span> <span class="o">-</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span>
</span></span></code></pre></div><h2 id="#最优方案总数">
    最优方案总数
    <a class="anchor" name="最优方案总数" href="#%e6%9c%80%e4%bc%98%e6%96%b9%e6%a1%88%e6%80%bb%e6%95%b0">#</a>
</h2><blockquote>
<p>基于 <a class="md-link" href="#01-%e8%83%8c%e5%8c%85"  >01 背包<img class="icon" src="../../../../../img/link.svg" /></a>，求最优方案数.</p>
</blockquote>
<p>已知 01 背包 的状态转移方程：</p>
<p>$$f[i,v] = \max\left\{\begin{aligned}
&amp;f[i-1,v]\\
&amp;f[i-1,v-w_i]&#43;c_i\quad(v≥w_i)\\
\end{aligned}\right.$$</p><p>$g[i,v]$：把前 $i$ 个物品（部分或全部）放入体积为 $v$ 的背包的最优方案数.</p>
<ul>
<li>
<p>若 $f[i-1,v]&gt;f[i-1,v-w_i]+c_i$，不放物品 $i$ 最优：$g[i,v]=g[i-1,v]$.</p>
</li>
<li>
<p>若 $f[i-1,v]&lt;f[i-1,v-w_i]+c_i$，放物品 $i$ 最优：$g[i,v]=g[i-1,v-w_i]$.</p>
</li>
<li>
<p>若相等，则两种方案都最优：$g[i,v]=g[i-1,v]+g[i-1,v-w_i]$.</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">v</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="p">;</span> <span class="n">v</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">v</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">&gt;=</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">v</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">v</span> <span class="o">-</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">v</span><span class="p">]</span> <span class="o">==</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">v</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="n">g</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">v</span><span class="p">]</span> <span class="o">+=</span> <span class="n">g</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">v</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">v</span><span class="p">]</span> <span class="o">==</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">v</span> <span class="o">-</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="n">g</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">v</span><span class="p">]</span> <span class="o">+=</span> <span class="n">g</span><span class="p">[</span><span class="n">v</span> <span class="o">-</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>省去第一维：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">v</span> <span class="o">=</span> <span class="n">m</span><span class="p">;</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">v</span> <span class="o">--</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">maxn</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">v</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="n">v</span> <span class="o">-</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">maxg</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// 最优方案数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span><span class="p">(</span><span class="n">maxn</span> <span class="o">==</span> <span class="n">f</span><span class="p">[</span><span class="n">v</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="n">maxg</span> <span class="o">+=</span> <span class="n">g</span><span class="p">[</span><span class="n">v</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">maxn</span> <span class="o">==</span> <span class="n">f</span><span class="p">[</span><span class="n">v</span> <span class="o">-</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="n">maxg</span> <span class="o">+=</span> <span class="n">g</span><span class="p">[</span><span class="n">v</span> <span class="o">-</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span>
</span></span><span class="line"><span class="cl">        <span class="n">f</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxn</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxg</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></article><div class="float-panel mobile-only blur" style="display:none">
  <button type="button" class="sidebar-toggle mobile" onclick="sidebar.toggle()">
    <svg class="icon" style="width:1em;height:1em;vertical-align:middle;fill:currentColor;overflow:hidden" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="15301">
      <path d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 2.3 26.8 24.6 47.5 51.6 47.6h416.5v4z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z" p-id="15302"></path>
      <path d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 1.9 27.7 23.9 49.7 51.6 51.6h416.5z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z" p-id="15303"></path>
    </svg>
  </button>
</div></main>
    </div>
</body>
<script src="../../../../../scripts/table-of-contents.js"></script>

<script src="https://cdn.staticfile.org/mathjax/2.7.7/MathJax.js" defer></script>
<script src="../../../../../scripts/mathjax.js"></script>
</html>